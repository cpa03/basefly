# Cloudflare Pages Configuration for Basefly
# Documentation: https://developers.cloudflare.com/pages/platform/build-configuration
# Best Practices: https://developers.cloudflare.com/workers/best-practices/

name = "basefly"
compatibility_date = "2026-02-18"
compatibility_flags = ["nodejs_compat"]

# Pages configuration
# Note: For Next.js apps, use @cloudflare/next-on-pages for full compatibility
pages_build_output_dir = "apps/nextjs/.next"

# Build configuration
[build]
command = "pnpm install && pnpm run build"

# Environment variables (set via Cloudflare Dashboard or wrangler secrets)
# These are placeholders - actual values should be set securely
[vars]
NODE_VERSION = "20"

# Production environment
[env.production]
name = "basefly"
routes = [
  { pattern = "/*", zone_name = "saasfly.io" }
]

# Preview environment for PRs
[env.preview]
name = "basefly-preview"

# Smart placement for optimal global distribution
# https://developers.cloudflare.com/workers/platform/smart-placement
[placement]
mode = "smart"

# Limits configuration (adjust based on your plan)
# https://developers.cloudflare.com/workers/platform/limits
[limits]
cpu_ms = 50000

# Development settings
[dev]
port = 8788
local_protocol = "http"

# Observability
[observability]
enabled = true

# Note: For full Next.js compatibility on Cloudflare Pages:
# 1. Install: pnpm add -D @cloudflare/next-on-pages
# 2. Add script to package.json: "pages:build": "next build && npx @cloudflare/next-on-pages"
# 3. Update build command in Cloudflare Dashboard to use pages:build
#
# Features enabled by @cloudflare/next-on-pages:
# - Edge Runtime support
# - API Routes
# - Middleware
# - Image Optimization (via Cloudflare Images)
#
# Security recommendations for Cloudflare Dashboard:
# - Enable Bot Fight Mode
# - Enable Browser Integrity Check
# - Set Security Level: Medium or Higher
# - SSL/TLS: Full (Strict)
# - Enable Always Use HTTPS
# - Enable Automatic HTTPS Rewrites
# - Enable HTTP/3 (QUIC)
